/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  JournalingAssistantPlugin: () => JournalingAssistantPlugin,
  default: () => main_default
});
module.exports = __toCommonJS(main_exports);
var import_obsidian6 = require("obsidian");

// src/types.ts
var DEFAULT_SETTINGS = {
  journalFolder: "Journal",
  inputsFolder: "Inputs",
  openAIApiKey: "",
  numberOfPastEntries: 3,
  useStreamingResponse: true
};

// src/services/JournalService.ts
var import_obsidian4 = require("obsidian");

// src/services/TranscriptionService.ts
var import_obsidian = require("obsidian");
var TranscriptionService = class {
  constructor(app, settings) {
    this.app = app;
    this.settings = settings;
    this.whisperService = new WhisperService(this.app.vault, this.settings.openAIApiKey);
  }
  updateSettings(settings) {
    this.settings = settings;
    this.whisperService.setApiKey(settings.openAIApiKey);
  }
  /**
   * Checks if the file format is directly supported by Whisper API
   */
  static isSupportedFormat(file) {
    const supportedFormats = ["flac", "mp3", "mp4", "mpeg", "mpga", "m4a", "ogg", "wav", "webm"];
    const extension = file.extension.toLowerCase();
    return supportedFormats.includes(extension);
  }
  /**
   * Prepares audio file for transcription
   */
  async prepareAudioForTranscription(file) {
    const arrayBuffer = await this.app.vault.readBinary(file);
    const extension = file.extension.toLowerCase();
    const mimeTypes = {
      "flac": "audio/flac",
      "mp3": "audio/mpeg",
      "mp4": "audio/mp4",
      "mpeg": "audio/mpeg",
      "mpga": "audio/mpeg",
      "m4a": "audio/mp4",
      "ogg": "audio/ogg",
      "wav": "audio/wav",
      "webm": "audio/webm"
    };
    const mimeType = mimeTypes[extension];
    if (!mimeType) {
      throw new Error(`Unsupported MIME type for extension: ${extension}`);
    }
    return {
      blob: new Blob([arrayBuffer], { type: mimeType }),
      mimeType
    };
  }
  /**
   * Returns a RegExp pattern that matches Obsidian's embed syntax for supported audio formats
   */
  static getRecordingEmbedPattern() {
    return /!\[\[.+\.(flac|mp3|mp4|mpeg|mpga|m4a|ogg|wav|webm)\]\]/g;
  }
  async transcribeRecordings() {
    const activeView = this.app.workspace.getActiveViewOfType(import_obsidian.MarkdownView);
    if (!activeView) {
      new import_obsidian.Notice("Please open a note first");
      return;
    }
    if (!this.settings.openAIApiKey) {
      new import_obsidian.Notice("OpenAI API key not configured");
      return;
    }
    const editor = activeView.editor;
    const content = editor.getValue();
    const recordingPattern = TranscriptionService.getRecordingEmbedPattern();
    const recordings = content.match(recordingPattern);
    if (!recordings || recordings.length === 0) {
      new import_obsidian.Notice("No recordings found in the current note");
      return;
    }
    new import_obsidian.Notice("Starting transcription...");
    let updatedContent = content;
    let hasErrors = false;
    try {
      for (const recording of recordings) {
        const fileName = recording.slice(3, -2);
        const file = this.app.metadataCache.getFirstLinkpathDest(fileName, "");
        if (!(file instanceof import_obsidian.TFile)) {
          new import_obsidian.Notice(`Could not find file: ${fileName}`);
          hasErrors = true;
          continue;
        }
        try {
          const transcript = await this.whisperService.transcribeFile(file);
          updatedContent = updatedContent.replace(recording, transcript);
        } catch (error) {
          new import_obsidian.Notice(`Failed to transcribe ${fileName}: ${error.message}`);
          hasErrors = true;
          continue;
        }
      }
      editor.setValue(updatedContent);
      if (hasErrors) {
        new import_obsidian.Notice("Transcription completed with some errors");
      } else {
        new import_obsidian.Notice("Transcription completed successfully");
      }
    } catch (error) {
      new import_obsidian.Notice(`Transcription failed: ${error.message}`);
      console.error("Transcription error:", error);
    }
  }
};

// src/services/WhisperService.ts
var WhisperService = class {
  constructor(vault, apiKey) {
    this.vault = vault;
    this.apiKey = apiKey;
  }
  setApiKey(apiKey) {
    this.apiKey = apiKey;
  }
  async transcribeFile(audioFile) {
    var _a;
    try {
      if (!this.apiKey) {
        throw new Error("OpenAI API key is required for transcription");
      }
      if (!TranscriptionService.isSupportedFormat(audioFile)) {
        throw new Error(`Unsupported audio format: ${audioFile.extension}`);
      }
      const formData = new FormData();
      const arrayBuffer = await this.vault.readBinary(audioFile);
      const blob = new Blob([arrayBuffer], { type: `audio/${audioFile.extension}` });
      formData.append("file", blob, `${audioFile.basename}.${audioFile.extension}`);
      formData.append("model", "whisper-1");
      const response = await fetch("https://api.openai.com/v1/audio/transcriptions", {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${this.apiKey}`
        },
        body: formData
      });
      if (!response.ok) {
        const error = await response.json();
        throw new Error(((_a = error.error) == null ? void 0 : _a.message) || "Transcription failed");
      }
      const result = await response.json();
      return result.text;
    } catch (error) {
      console.error("Transcription error:", error);
      throw error;
    }
  }
};

// src/services/SummarizationService.ts
var import_obsidian2 = require("obsidian");

// src/prompts/summaryPrompt.ts
var summaryPrompt_default = `As a journaling assistant, analyze this journal entry and create a concise summary that:

1. Identifies the main themes and insights
2. Highlights key realizations or breakthroughs
3. Notes any action items or intentions expressed
4. Preserves the emotional tone of the entry

Focus on extracting the most meaningful elements while maintaining the personal nature of the reflection.`;

// src/services/SummarizationService.ts
var SummarizationService = class {
  constructor(openAIService) {
    this.openAIService = openAIService;
  }
  /**
   * Takes the user's journal response and returns a summary
   * @param content The content to summarize
   * @param useStreaming Whether to stream the response
   * @param onChunk Optional callback for streaming responses
   */
  async summarize(content, useStreaming = false, onChunk) {
    try {
      const prompt = `${summaryPrompt_default}

${content}`;
      return await this.openAIService.makeOpenAIRequest(
        prompt,
        useStreaming ? onChunk : void 0
      );
    } catch (error) {
      new import_obsidian2.Notice(`Error during summarization: ${error.message}`);
      throw error;
    }
  }
};

// src/services/PromptService.ts
var import_obsidian3 = require("obsidian");

// src/prompts/journalPrompt.ts
var journalPrompt_default = `As a friendly journaling guide, analyze these past journal entries and create a thought-provoking prompt 
that encourages deeper self-reflection while maintaining continuity with previous themes and insights. 
Write the outline in a second person, the user should feel like they are talking to a friend.

Before the prompt:
1. Outline the aspects of past entries to allow for better self-reflection, only if there are past entries.
2. Don't make up information, only use the information that is provided in the past entries.
3. Keep a friendly tone, the user should feel like they are talking to a friend
4. Be concise and to the point
5. Always start with "## Recap of past entries", even if there are no past entries.
6. If there's an information that there are no past entries, just write "No past entries available."

The prompt should:
1. Be specific and actionable
2. Keep a friendly tone, the user should feel like they are talking to a friend
3. Don't steer the user into any particular direction, we want to let the user explore their own thoughts and feelings
4. Make the prompt open-ended, in the first message we want to explore how the user is feeling today and what they want to achieve with the journal
5. Inform the user that they can choose one question and continue conversation with the assistant
6. Be concise, if you ask questions, make them a list of bullet points so it's easy to read
7. Start with "## Today's Prompt"

Keep the prompt concise and focused on a single aspect of self-reflection. Please structure your output so it's easy to read and understand.


The final structure should look like this:

## Recap of past entries
<outline of past entries>

## Today's Prompt
<prompt>`;

// src/services/PromptService.ts
var PromptService = class {
  constructor(openAIService) {
    this.openAIService = openAIService;
  }
  /**
   * Generates a journal prompt based on past entries
   * @param pastEntries Array of past journal entries
   * @param onChunk Optional callback for streaming responses
   */
  async generatePrompt(pastEntries, onChunk) {
    try {
      const pastEntriesText = pastEntries.length > 0 ? `Past Entries:

${pastEntries.join("\n\n---\n\n")}` : "No past entries available.";
      const prompt = `${journalPrompt_default}

${pastEntriesText}`;
      return await this.openAIService.makeOpenAIRequest(prompt, onChunk);
    } catch (error) {
      new import_obsidian3.Notice(`Error generating prompt: ${error.message}`);
      throw error;
    }
  }
};

// src/prompts/chatPrompt.ts
var chatPrompt_default = `As an AI journaling assistant, you are helping the user explore their thoughts and goals.
Guiding principles:
\u2022 Maintain a friendly, empathetic tone
\u2022 Ask clarifying questions or deeper prompts
\u2022 Avoid steering the user to specific beliefs or conclusions
\u2022 Keep the conversation relevant to the user\u2019s stated goals
\u2022 Encourage reflection and actionable outcomes where appropriate
Remember: all interactions take place in the user\u2019s note.`;

// src/services/ChatService.ts
var ChatService = class {
  constructor(openAIService) {
    this.openAIService = openAIService;
  }
  /**
   * Sends the userâ€™s note content (with any transcribed text) to OpenAI
   * and returns a friendly, conversational response.
   */
  async chat(transcribedText) {
    const prompt = `${chatPrompt_default}

User: ${transcribedText}

Assistant:`;
    return this.openAIService.makeOpenAIRequest(prompt);
  }
};

// src/services/JournalService.ts
var JournalService = class {
  constructor(app, settings, openAIService) {
    this.app = app;
    this.settings = settings;
    this.openAIService = openAIService;
    this.whisperService = new WhisperService(this.app.vault, this.settings.openAIApiKey);
    this.summarizationService = new SummarizationService(this.openAIService);
    this.promptService = new PromptService(this.openAIService);
    this.chatService = new ChatService(this.openAIService);
    this.transcriptionService = new TranscriptionService(this.app, this.settings);
  }
  updateSettings(settings) {
    this.settings = settings;
    this.whisperService.setApiKey(settings.openAIApiKey);
    this.transcriptionService.updateSettings(settings);
    this.openAIService.updateSettings(settings);
  }
  getTodayFileName() {
    const date = new Date();
    return date.toISOString().split("T")[0] + ".md";
  }
  async ensureFolder(folderPath) {
    if (!await this.app.vault.adapter.exists(folderPath)) {
      await this.app.vault.createFolder(folderPath);
    }
  }
  async getPastJournalEntries(count) {
    const folder = this.app.vault.getAbstractFileByPath(this.settings.journalFolder);
    if (!folder)
      return [];
    const files = this.app.vault.getMarkdownFiles().filter((file) => file.path.startsWith(this.settings.journalFolder + "/")).sort((a, b) => b.stat.mtime - a.stat.mtime).slice(0, count);
    const entries = await Promise.all(
      files.map(async (file) => {
        const content = await this.app.vault.read(file);
        return {
          date: file.basename,
          content
        };
      })
    );
    return entries.map((entry) => `Date: ${entry.date}
${entry.content}`);
  }
  async openTodaysJournal() {
    try {
      await this.ensureFolder(this.settings.journalFolder);
      const fileName = this.getTodayFileName();
      const filePath = `${this.settings.journalFolder}/${fileName}`;
      let file = this.app.vault.getAbstractFileByPath(filePath);
      if (!file) {
        let initialContent = `# Journal Entry - ${new Date().toLocaleDateString()}

`;
        file = await this.app.vault.create(filePath, initialContent);
        try {
          const loadingNotice = new import_obsidian4.Notice("Generating journal prompt...", 0);
          const pastEntries = await this.getPastJournalEntries(this.settings.numberOfPastEntries);
          const leaf = this.app.workspace.getLeaf(false);
          await leaf.openFile(file);
          const view = this.app.workspace.getActiveViewOfType(import_obsidian4.MarkdownView);
          if (view) {
            if (this.settings.useStreamingResponse) {
              await this.promptService.generatePrompt(pastEntries, (chunk) => {
                const currentContent = view.editor.getValue();
                view.editor.setValue(currentContent + chunk);
              });
            } else {
              const aiPrompt = await this.promptService.generatePrompt(pastEntries);
              view.editor.setValue(view.editor.getValue() + aiPrompt);
            }
            const finalContent = view.editor.getValue();
            view.editor.setValue(finalContent + "\n\n## Your Journal Response\n\n");
          }
          loadingNotice.hide();
          new import_obsidian4.Notice("Created new journal entry for today");
        } catch (error) {
          new import_obsidian4.Notice("Error generating prompt: " + error.message);
          const view = this.app.workspace.getActiveViewOfType(import_obsidian4.MarkdownView);
          if (view) {
            view.editor.setValue(view.editor.getValue() + "\n\n## Your Journal Response\n\n");
          }
        }
      } else {
        const leaf = this.app.workspace.getLeaf(false);
        await leaf.openFile(file);
      }
    } catch (error) {
      new import_obsidian4.Notice("Error opening today's journal: " + error.message);
      console.error("Error opening today's journal:", error);
    }
  }
  async summarizeJournalingSession() {
    const activeView = this.app.workspace.getActiveViewOfType(import_obsidian4.MarkdownView);
    if (!activeView) {
      new import_obsidian4.Notice("Please open a note first");
      return;
    }
    if (!activeView.file) {
      new import_obsidian4.Notice("No file is currently open");
      return;
    }
    try {
      const originalContent = activeView.editor.getValue();
      const fileName = activeView.file.name;
      const inputPath = `${this.settings.inputsFolder}/${fileName}`;
      await this.ensureFolder(this.settings.inputsFolder);
      await this.app.vault.create(inputPath, originalContent);
      let processedContent = await this.processContent(originalContent);
      const responseMatch = processedContent.match(/## Your Journal Response\n\n([\s\S]*$)/);
      if (!responseMatch) {
        new import_obsidian4.Notice("Could not find journal response section");
        return;
      }
      const userResponse = responseMatch[1];
      let summary;
      if (this.settings.useStreamingResponse) {
        let streamedSummary = "";
        summary = await this.summarizationService.summarize(
          userResponse,
          true,
          (chunk) => {
            streamedSummary += chunk;
            const updatedContent2 = processedContent.replace(
              /## Your Journal Response\n\n[\s\S]*$/,
              `## Your Journal Response

${streamedSummary}`
            );
            activeView.editor.setValue(updatedContent2);
          }
        );
      } else {
        summary = await this.summarizationService.summarize(userResponse);
      }
      const updatedContent = processedContent.replace(
        /## Your Journal Response\n\n[\s\S]*$/,
        `## Your Journal Response

${summary}`
      );
      activeView.editor.setValue(updatedContent);
      new import_obsidian4.Notice("Journal session summarized");
    } catch (error) {
      new import_obsidian4.Notice(`Error: ${error.message}`);
      console.error("Summarization error:", error);
    }
  }
  async processContent(content) {
    const recordingPattern = TranscriptionService.getRecordingEmbedPattern();
    const recordings = content.match(recordingPattern);
    if (!recordings)
      return content;
    let processedContent = content;
    for (const recording of recordings) {
      const fileName = recording.slice(3, -2);
      const file = this.app.metadataCache.getFirstLinkpathDest(fileName, "");
      if (file instanceof import_obsidian4.TFile) {
        const transcript = await this.whisperService.transcribeFile(file);
        processedContent = processedContent.replace(recording, transcript);
      }
    }
    return processedContent;
  }
  async chatWithAI() {
    const activeView = this.app.workspace.getActiveViewOfType(import_obsidian4.MarkdownView);
    if (!activeView) {
      new import_obsidian4.Notice("Please open a note first");
      return;
    }
    await this.transcriptionService.transcribeRecordings();
    const content = activeView.editor.getValue();
    try {
      const chatResponse = await this.chatService.chat(content);
      activeView.editor.setValue(
        content + "\n\n## AI Chat\n\n" + chatResponse
      );
      new import_obsidian4.Notice("AI responded in note");
    } catch (error) {
      new import_obsidian4.Notice(`Error during chat: ${error.message}`);
    }
  }
};

// src/services/OpenAIService.ts
var OpenAIService = class {
  constructor(settings) {
    this.settings = settings;
  }
  updateSettings(settings) {
    this.settings = settings;
  }
  async makeOpenAIRequest(prompt, onChunk) {
    var _a, _b, _c, _d;
    if (!this.settings.openAIApiKey) {
      throw new Error("OpenAI API key not configured");
    }
    try {
      const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${this.settings.openAIApiKey}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          model: "gpt-4o-mini",
          messages: [{ role: "user", content: prompt }],
          temperature: 0.7,
          stream: !!onChunk
          // Enable streaming if onChunk callback is provided
        })
      });
      if (!response.ok) {
        const error = await response.json();
        throw new Error(((_a = error.error) == null ? void 0 : _a.message) || "API request failed");
      }
      if (onChunk) {
        const reader = (_b = response.body) == null ? void 0 : _b.getReader();
        const decoder = new TextDecoder();
        let fullResponse = "";
        if (!reader)
          throw new Error("Response body is null");
        while (true) {
          const { done, value } = await reader.read();
          if (done)
            break;
          const chunk = decoder.decode(value);
          const lines = chunk.split("\n").filter((line) => line.trim() !== "");
          for (const line of lines) {
            if (line.includes("[DONE]"))
              continue;
            if (!line.startsWith("data:"))
              continue;
            try {
              const json = JSON.parse(line.slice(5));
              const content = (_d = (_c = json.choices[0]) == null ? void 0 : _c.delta) == null ? void 0 : _d.content;
              if (content) {
                fullResponse += content;
                onChunk(content);
              }
            } catch (e) {
              console.warn("Failed to parse streaming response:", e);
            }
          }
        }
        return fullResponse;
      }
      const data = await response.json();
      return data.choices[0].message.content;
    } catch (error) {
      console.error("OpenAI API error:", error);
      throw error;
    }
  }
};

// src/settings/SettingTab.ts
var import_obsidian5 = require("obsidian");
var JournalingAssistantSettingTab = class extends import_obsidian5.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    containerEl.createEl("h2", { text: "Journaling Assistant Settings" });
    new import_obsidian5.Setting(containerEl).setName("Journal Folder").setDesc("The folder where your journal entries will be stored").addText((text) => text.setPlaceholder("Journal").setValue(this.plugin.settings.journalFolder).onChange(async (value) => {
      this.plugin.settings.journalFolder = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian5.Setting(containerEl).setName("Journal Inputs Folder").setDesc("The folder where your journal inputs will be stored").addText((text) => text.setPlaceholder("Inputs").setValue(this.plugin.settings.inputsFolder).onChange(async (value) => {
      this.plugin.settings.inputsFolder = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian5.Setting(containerEl).setName("OpenAI API Key").setDesc("Your OpenAI API key for generating prompts and summaries").addText((text) => text.setPlaceholder("sk-...").setValue(this.plugin.settings.openAIApiKey).onChange(async (value) => {
      this.plugin.settings.openAIApiKey = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian5.Setting(containerEl).setName("Number of Past Entries").setDesc("Number of past journal entries to consider when generating prompts").addSlider((slider) => slider.setLimits(0, 10, 1).setValue(this.plugin.settings.numberOfPastEntries).setDynamicTooltip().onChange(async (value) => {
      this.plugin.settings.numberOfPastEntries = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian5.Setting(containerEl).setName("Use Streaming Response").setDesc("Stream AI responses in real-time (recommended for better experience)").addToggle((toggle) => toggle.setValue(this.plugin.settings.useStreamingResponse).onChange(async (value) => {
      this.plugin.settings.useStreamingResponse = value;
      await this.plugin.saveSettings();
    }));
  }
};

// main.ts
var JournalingAssistantPlugin = class extends import_obsidian6.Plugin {
  async onload() {
    await this.loadSettings();
    this.openAIService = new OpenAIService(this.settings);
    this.journalService = new JournalService(this.app, this.settings, this.openAIService);
    this.transcriptionService = new TranscriptionService(this.app, this.settings);
    this.addSettingTab(new JournalingAssistantSettingTab(this.app, this));
    this.addRibbonIcon("bot", "Journaling Assistant", (evt) => {
      const menu = new import_obsidian6.Menu();
      menu.addItem(
        (item) => item.setTitle("Open Today's Journal").onClick(() => {
          this.journalService.openTodaysJournal();
        })
      );
      menu.addItem(
        (item) => item.setTitle("Chat with AI").onClick(() => {
          this.journalService.chatWithAI();
        })
      );
      menu.addItem(
        (item) => item.setTitle("Summarize Journaling Session").onClick(() => {
          this.journalService.summarizeJournalingSession();
        })
      );
      menu.showAtMouseEvent(evt);
    });
    this.addCommands();
  }
  addCommands() {
    this.addCommand({
      id: "open-todays-journal",
      name: "Open Today's Journal",
      callback: async () => {
        await this.journalService.openTodaysJournal();
      }
    });
    this.addCommand({
      id: "transcribe-recordings",
      name: "Transcribe Recordings",
      callback: async () => {
        await this.transcriptionService.transcribeRecordings();
      }
    });
    this.addCommand({
      id: "summarize-journal",
      name: "Summarize Journaling Session",
      callback: async () => {
        await this.journalService.summarizeJournalingSession();
      }
    });
    this.addCommand({
      id: "chat-with-ai",
      name: "Chat with AI",
      callback: async () => {
        await this.journalService.chatWithAI();
      }
    });
  }
  async loadSettings() {
    const data = await this.loadData();
    this.settings = Object.assign({}, DEFAULT_SETTINGS, data);
    console.log(this.settings);
  }
  async saveSettings() {
    await this.saveData(this.settings);
    this.openAIService = new OpenAIService(this.settings);
    this.transcriptionService.updateSettings(this.settings);
    this.journalService.updateSettings(this.settings);
  }
  onunload() {
    console.log("Unloading Journaling Assistant Plugin...");
  }
};
var main_default = JournalingAssistantPlugin;
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyIsICJzcmMvdHlwZXMudHMiLCAic3JjL3NlcnZpY2VzL0pvdXJuYWxTZXJ2aWNlLnRzIiwgInNyYy9zZXJ2aWNlcy9UcmFuc2NyaXB0aW9uU2VydmljZS50cyIsICJzcmMvc2VydmljZXMvV2hpc3BlclNlcnZpY2UudHMiLCAic3JjL3NlcnZpY2VzL1N1bW1hcml6YXRpb25TZXJ2aWNlLnRzIiwgInNyYy9wcm9tcHRzL3N1bW1hcnlQcm9tcHQudHMiLCAic3JjL3NlcnZpY2VzL1Byb21wdFNlcnZpY2UudHMiLCAic3JjL3Byb21wdHMvam91cm5hbFByb21wdC50cyIsICJzcmMvcHJvbXB0cy9jaGF0UHJvbXB0LnRzIiwgInNyYy9zZXJ2aWNlcy9DaGF0U2VydmljZS50cyIsICJzcmMvc2VydmljZXMvT3BlbkFJU2VydmljZS50cyIsICJzcmMvc2V0dGluZ3MvU2V0dGluZ1RhYi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQXBwLCBQbHVnaW4sIE1hcmtkb3duVmlldywgTm90aWNlLCBNZW51IH0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0IHsgSm91cm5hbGluZ0Fzc2lzdGFudFNldHRpbmdzLCBERUZBVUxUX1NFVFRJTkdTIH0gZnJvbSAnLi9zcmMvdHlwZXMnO1xuaW1wb3J0IHsgSm91cm5hbFNlcnZpY2UgfSBmcm9tICcuL3NyYy9zZXJ2aWNlcy9Kb3VybmFsU2VydmljZSc7XG5pbXBvcnQgeyBPcGVuQUlTZXJ2aWNlIH0gZnJvbSAnLi9zcmMvc2VydmljZXMvT3BlbkFJU2VydmljZSc7XG5pbXBvcnQgeyBKb3VybmFsaW5nQXNzaXN0YW50U2V0dGluZ1RhYiB9IGZyb20gJy4vc3JjL3NldHRpbmdzL1NldHRpbmdUYWInO1xuaW1wb3J0IHsgVHJhbnNjcmlwdGlvblNlcnZpY2UgfSBmcm9tICcuL3NyYy9zZXJ2aWNlcy9UcmFuc2NyaXB0aW9uU2VydmljZSc7XG5cbmV4cG9ydCBjbGFzcyBKb3VybmFsaW5nQXNzaXN0YW50UGx1Z2luIGV4dGVuZHMgUGx1Z2luIHtcbiAgICBzZXR0aW5nczogSm91cm5hbGluZ0Fzc2lzdGFudFNldHRpbmdzO1xuICAgIHByaXZhdGUgam91cm5hbFNlcnZpY2U6IEpvdXJuYWxTZXJ2aWNlO1xuICAgIHByaXZhdGUgb3BlbkFJU2VydmljZTogT3BlbkFJU2VydmljZTtcbiAgICBwcml2YXRlIHRyYW5zY3JpcHRpb25TZXJ2aWNlOiBUcmFuc2NyaXB0aW9uU2VydmljZTtcblxuICAgIGFzeW5jIG9ubG9hZCgpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5sb2FkU2V0dGluZ3MoKTtcbiAgICAgICAgXG4gICAgICAgIHRoaXMub3BlbkFJU2VydmljZSA9IG5ldyBPcGVuQUlTZXJ2aWNlKHRoaXMuc2V0dGluZ3MpO1xuICAgICAgICB0aGlzLmpvdXJuYWxTZXJ2aWNlID0gbmV3IEpvdXJuYWxTZXJ2aWNlKHRoaXMuYXBwLCB0aGlzLnNldHRpbmdzLCB0aGlzLm9wZW5BSVNlcnZpY2UpO1xuICAgICAgICB0aGlzLnRyYW5zY3JpcHRpb25TZXJ2aWNlID0gbmV3IFRyYW5zY3JpcHRpb25TZXJ2aWNlKHRoaXMuYXBwLCB0aGlzLnNldHRpbmdzKTtcblxuICAgICAgICAvLyBBZGQgc2V0dGluZ3MgdGFiXG4gICAgICAgIHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgSm91cm5hbGluZ0Fzc2lzdGFudFNldHRpbmdUYWIodGhpcy5hcHAsIHRoaXMpKTtcblxuICAgICAgICAvLyBBZGQgcmliYm9uIGljb25cbiAgICAgICAgdGhpcy5hZGRSaWJib25JY29uKCdib3QnLCAnSm91cm5hbGluZyBBc3Npc3RhbnQnLCAoZXZ0OiBNb3VzZUV2ZW50IHwgUG9pbnRlckV2ZW50KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBtZW51ID0gbmV3IE1lbnUoKTtcbiAgICAgICAgICAgIG1lbnUuYWRkSXRlbSgoaXRlbSkgPT5cbiAgICAgICAgICAgICAgICBpdGVtXG4gICAgICAgICAgICAgICAgICAgIC5zZXRUaXRsZShcIk9wZW4gVG9kYXkncyBKb3VybmFsXCIpXG4gICAgICAgICAgICAgICAgICAgIC5vbkNsaWNrKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuam91cm5hbFNlcnZpY2Uub3BlblRvZGF5c0pvdXJuYWwoKTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBtZW51LmFkZEl0ZW0oKGl0ZW0pID0+XG4gICAgICAgICAgICAgICAgaXRlbVxuICAgICAgICAgICAgICAgICAgICAuc2V0VGl0bGUoXCJDaGF0IHdpdGggQUlcIilcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2xpY2soKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5qb3VybmFsU2VydmljZS5jaGF0V2l0aEFJKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgbWVudS5hZGRJdGVtKChpdGVtKSA9PlxuICAgICAgICAgICAgICAgIGl0ZW1cbiAgICAgICAgICAgICAgICAgICAgLnNldFRpdGxlKFwiU3VtbWFyaXplIEpvdXJuYWxpbmcgU2Vzc2lvblwiKVxuICAgICAgICAgICAgICAgICAgICAub25DbGljaygoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmpvdXJuYWxTZXJ2aWNlLnN1bW1hcml6ZUpvdXJuYWxpbmdTZXNzaW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgbWVudS5zaG93QXRNb3VzZUV2ZW50KGV2dCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYWRkQ29tbWFuZHMoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFkZENvbW1hbmRzKCkge1xuICAgICAgICB0aGlzLmFkZENvbW1hbmQoe1xuICAgICAgICAgICAgaWQ6ICdvcGVuLXRvZGF5cy1qb3VybmFsJyxcbiAgICAgICAgICAgIG5hbWU6ICdPcGVuIFRvZGF5XFwncyBKb3VybmFsJyxcbiAgICAgICAgICAgIGNhbGxiYWNrOiBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5qb3VybmFsU2VydmljZS5vcGVuVG9kYXlzSm91cm5hbCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgICAgICAgIGlkOiAndHJhbnNjcmliZS1yZWNvcmRpbmdzJyxcbiAgICAgICAgICAgIG5hbWU6ICdUcmFuc2NyaWJlIFJlY29yZGluZ3MnLFxuICAgICAgICAgICAgY2FsbGJhY2s6IGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnRyYW5zY3JpcHRpb25TZXJ2aWNlLnRyYW5zY3JpYmVSZWNvcmRpbmdzKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmFkZENvbW1hbmQoe1xuICAgICAgICAgICAgaWQ6ICdzdW1tYXJpemUtam91cm5hbCcsXG4gICAgICAgICAgICBuYW1lOiAnU3VtbWFyaXplIEpvdXJuYWxpbmcgU2Vzc2lvbicsXG4gICAgICAgICAgICBjYWxsYmFjazogYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuam91cm5hbFNlcnZpY2Uuc3VtbWFyaXplSm91cm5hbGluZ1Nlc3Npb24oKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIE5ldyBDaGF0IHdpdGggQUkgY29tbWFuZFxuICAgICAgICB0aGlzLmFkZENvbW1hbmQoe1xuICAgICAgICAgICAgaWQ6ICdjaGF0LXdpdGgtYWknLFxuICAgICAgICAgICAgbmFtZTogJ0NoYXQgd2l0aCBBSScsXG4gICAgICAgICAgICBjYWxsYmFjazogYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuam91cm5hbFNlcnZpY2UuY2hhdFdpdGhBSSgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgYXN5bmMgbG9hZFNldHRpbmdzKCkge1xuICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgdGhpcy5sb2FkRGF0YSgpO1xuICAgICAgICB0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgZGF0YSk7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuc2V0dGluZ3MpO1xuICAgIH1cblxuICAgIGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcbiAgICAgICAgLy8gVXBkYXRlIHNlcnZpY2VzIHdpdGggbmV3IHNldHRpbmdzXG4gICAgICAgIHRoaXMub3BlbkFJU2VydmljZSA9IG5ldyBPcGVuQUlTZXJ2aWNlKHRoaXMuc2V0dGluZ3MpO1xuICAgICAgICB0aGlzLnRyYW5zY3JpcHRpb25TZXJ2aWNlLnVwZGF0ZVNldHRpbmdzKHRoaXMuc2V0dGluZ3MpO1xuICAgICAgICB0aGlzLmpvdXJuYWxTZXJ2aWNlLnVwZGF0ZVNldHRpbmdzKHRoaXMuc2V0dGluZ3MpO1xuICAgIH1cblxuICAgIG9udW5sb2FkKCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIlVubG9hZGluZyBKb3VybmFsaW5nIEFzc2lzdGFudCBQbHVnaW4uLi5cIik7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBKb3VybmFsaW5nQXNzaXN0YW50UGx1Z2luO1xuIiwgImV4cG9ydCBpbnRlcmZhY2UgSm91cm5hbGluZ0Fzc2lzdGFudFNldHRpbmdzIHtcbiAgICBqb3VybmFsRm9sZGVyOiBzdHJpbmc7XG4gICAgaW5wdXRzRm9sZGVyOiBzdHJpbmc7XG4gICAgb3BlbkFJQXBpS2V5OiBzdHJpbmc7XG4gICAgbnVtYmVyT2ZQYXN0RW50cmllczogbnVtYmVyO1xuICAgIHVzZVN0cmVhbWluZ1Jlc3BvbnNlOiBib29sZWFuO1xufVxuXG5leHBvcnQgY29uc3QgREVGQVVMVF9TRVRUSU5HUzogSm91cm5hbGluZ0Fzc2lzdGFudFNldHRpbmdzID0ge1xuICAgIGpvdXJuYWxGb2xkZXI6ICdKb3VybmFsJyxcbiAgICBpbnB1dHNGb2xkZXI6ICdJbnB1dHMnLFxuICAgIG9wZW5BSUFwaUtleTogJycsXG4gICAgbnVtYmVyT2ZQYXN0RW50cmllczogMyxcbiAgICB1c2VTdHJlYW1pbmdSZXNwb25zZTogdHJ1ZSxcbn07ICIsICJpbXBvcnQgeyBBcHAsIFRGaWxlLCBOb3RpY2UsIE1hcmtkb3duVmlldywgVmlldyB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IEpvdXJuYWxpbmdBc3Npc3RhbnRTZXR0aW5ncyB9IGZyb20gJy4uL3R5cGVzJztcbmltcG9ydCB7IE9wZW5BSVNlcnZpY2UgfSBmcm9tICcuL09wZW5BSVNlcnZpY2UnO1xuaW1wb3J0IHsgV2hpc3BlclNlcnZpY2UgfSBmcm9tICcuL1doaXNwZXJTZXJ2aWNlJztcbmltcG9ydCB7IFRyYW5zY3JpcHRpb25TZXJ2aWNlIH0gZnJvbSAnLi9UcmFuc2NyaXB0aW9uU2VydmljZSc7XG5pbXBvcnQgeyBTdW1tYXJpemF0aW9uU2VydmljZSB9IGZyb20gJy4vU3VtbWFyaXphdGlvblNlcnZpY2UnO1xuaW1wb3J0IHsgUHJvbXB0U2VydmljZSB9IGZyb20gJy4vUHJvbXB0U2VydmljZSc7XG5pbXBvcnQgeyBDaGF0U2VydmljZSB9IGZyb20gJy4vQ2hhdFNlcnZpY2UnO1xuXG5leHBvcnQgY2xhc3MgSm91cm5hbFNlcnZpY2Uge1xuICAgIHByaXZhdGUgd2hpc3BlclNlcnZpY2U6IFdoaXNwZXJTZXJ2aWNlO1xuICAgIHByaXZhdGUgc3VtbWFyaXphdGlvblNlcnZpY2U6IFN1bW1hcml6YXRpb25TZXJ2aWNlO1xuICAgIHByaXZhdGUgcHJvbXB0U2VydmljZTogUHJvbXB0U2VydmljZTtcbiAgICBwcml2YXRlIGNoYXRTZXJ2aWNlOiBDaGF0U2VydmljZTtcbiAgICBwcml2YXRlIHRyYW5zY3JpcHRpb25TZXJ2aWNlOiBUcmFuc2NyaXB0aW9uU2VydmljZTtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIGFwcDogQXBwLFxuICAgICAgICBwcml2YXRlIHNldHRpbmdzOiBKb3VybmFsaW5nQXNzaXN0YW50U2V0dGluZ3MsXG4gICAgICAgIHByaXZhdGUgb3BlbkFJU2VydmljZTogT3BlbkFJU2VydmljZVxuICAgICkge1xuICAgICAgICB0aGlzLndoaXNwZXJTZXJ2aWNlID0gbmV3IFdoaXNwZXJTZXJ2aWNlKHRoaXMuYXBwLnZhdWx0LCB0aGlzLnNldHRpbmdzLm9wZW5BSUFwaUtleSk7XG4gICAgICAgIHRoaXMuc3VtbWFyaXphdGlvblNlcnZpY2UgPSBuZXcgU3VtbWFyaXphdGlvblNlcnZpY2UodGhpcy5vcGVuQUlTZXJ2aWNlKTtcbiAgICAgICAgdGhpcy5wcm9tcHRTZXJ2aWNlID0gbmV3IFByb21wdFNlcnZpY2UodGhpcy5vcGVuQUlTZXJ2aWNlKTtcbiAgICAgICAgdGhpcy5jaGF0U2VydmljZSA9IG5ldyBDaGF0U2VydmljZSh0aGlzLm9wZW5BSVNlcnZpY2UpO1xuICAgICAgICB0aGlzLnRyYW5zY3JpcHRpb25TZXJ2aWNlID0gbmV3IFRyYW5zY3JpcHRpb25TZXJ2aWNlKHRoaXMuYXBwLCB0aGlzLnNldHRpbmdzKTtcbiAgICB9XG5cbiAgICB1cGRhdGVTZXR0aW5ncyhzZXR0aW5nczogSm91cm5hbGluZ0Fzc2lzdGFudFNldHRpbmdzKSB7XG4gICAgICAgIHRoaXMuc2V0dGluZ3MgPSBzZXR0aW5ncztcbiAgICAgICAgdGhpcy53aGlzcGVyU2VydmljZS5zZXRBcGlLZXkoc2V0dGluZ3Mub3BlbkFJQXBpS2V5KTtcbiAgICAgICAgdGhpcy50cmFuc2NyaXB0aW9uU2VydmljZS51cGRhdGVTZXR0aW5ncyhzZXR0aW5ncyk7XG4gICAgICAgIHRoaXMub3BlbkFJU2VydmljZS51cGRhdGVTZXR0aW5ncyhzZXR0aW5ncyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRUb2RheUZpbGVOYW1lKCk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICByZXR1cm4gZGF0ZS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF0gKyAnLm1kJzsgLy8gRm9ybWF0OiBZWVlZLU1NLURELm1kXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBlbnN1cmVGb2xkZXIoZm9sZGVyUGF0aDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGlmICghKGF3YWl0IHRoaXMuYXBwLnZhdWx0LmFkYXB0ZXIuZXhpc3RzKGZvbGRlclBhdGgpKSkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlRm9sZGVyKGZvbGRlclBhdGgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBnZXRQYXN0Sm91cm5hbEVudHJpZXMoY291bnQ6IG51bWJlcik6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICAgICAgY29uc3QgZm9sZGVyID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKHRoaXMuc2V0dGluZ3Muam91cm5hbEZvbGRlcik7XG4gICAgICAgIGlmICghZm9sZGVyKSByZXR1cm4gW107XG5cbiAgICAgICAgY29uc3QgZmlsZXMgPSB0aGlzLmFwcC52YXVsdC5nZXRNYXJrZG93bkZpbGVzKClcbiAgICAgICAgICAgIC5maWx0ZXIoZmlsZSA9PiBmaWxlLnBhdGguc3RhcnRzV2l0aCh0aGlzLnNldHRpbmdzLmpvdXJuYWxGb2xkZXIgKyAnLycpKVxuICAgICAgICAgICAgLnNvcnQoKGEsIGIpID0+IGIuc3RhdC5tdGltZSAtIGEuc3RhdC5tdGltZSlcbiAgICAgICAgICAgIC5zbGljZSgwLCBjb3VudCk7XG5cbiAgICAgICAgY29uc3QgZW50cmllcyA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgICAgICAgZmlsZXMubWFwKGFzeW5jIGZpbGUgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpO1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGU6IGZpbGUuYmFzZW5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGNvbnRlbnRcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSlcbiAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4gZW50cmllcy5tYXAoZW50cnkgPT4gYERhdGU6ICR7ZW50cnkuZGF0ZX1cXG4ke2VudHJ5LmNvbnRlbnR9YCk7XG4gICAgfVxuXG4gICAgYXN5bmMgb3BlblRvZGF5c0pvdXJuYWwoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmVuc3VyZUZvbGRlcih0aGlzLnNldHRpbmdzLmpvdXJuYWxGb2xkZXIpO1xuXG4gICAgICAgICAgICBjb25zdCBmaWxlTmFtZSA9IHRoaXMuZ2V0VG9kYXlGaWxlTmFtZSgpO1xuICAgICAgICAgICAgY29uc3QgZmlsZVBhdGggPSBgJHt0aGlzLnNldHRpbmdzLmpvdXJuYWxGb2xkZXJ9LyR7ZmlsZU5hbWV9YDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbGV0IGZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZmlsZVBhdGgpO1xuXG4gICAgICAgICAgICBpZiAoIWZpbGUpIHtcbiAgICAgICAgICAgICAgICBsZXQgaW5pdGlhbENvbnRlbnQgPSBgIyBKb3VybmFsIEVudHJ5IC0gJHtuZXcgRGF0ZSgpLnRvTG9jYWxlRGF0ZVN0cmluZygpfVxcblxcbmA7XG4gICAgICAgICAgICAgICAgZmlsZSA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LmNyZWF0ZShmaWxlUGF0aCwgaW5pdGlhbENvbnRlbnQpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvYWRpbmdOb3RpY2UgPSBuZXcgTm90aWNlKCdHZW5lcmF0aW5nIGpvdXJuYWwgcHJvbXB0Li4uJywgMCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhc3RFbnRyaWVzID0gYXdhaXQgdGhpcy5nZXRQYXN0Sm91cm5hbEVudHJpZXModGhpcy5zZXR0aW5ncy5udW1iZXJPZlBhc3RFbnRyaWVzKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSB0aGUgZmlsZSB3aXRoIGluaXRpYWwgY29udGVudCBmaXJzdFxuICAgICAgICAgICAgICAgICAgICBjb25zdCBsZWFmID0gdGhpcy5hcHAud29ya3NwYWNlLmdldExlYWYoZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCBsZWFmLm9wZW5GaWxlKGZpbGUgYXMgVEZpbGUpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2aWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGlmICh2aWV3KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy51c2VTdHJlYW1pbmdSZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN0cmVhbSB0aGUgQUkgcmVzcG9uc2UgZGlyZWN0bHkgaW50byB0aGUgZWRpdG9yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wcm9tcHRTZXJ2aWNlLmdlbmVyYXRlUHJvbXB0KHBhc3RFbnRyaWVzLCAoY2h1bmspID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudENvbnRlbnQgPSB2aWV3LmVkaXRvci5nZXRWYWx1ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3LmVkaXRvci5zZXRWYWx1ZShjdXJyZW50Q29udGVudCArIGNodW5rKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gR2V0IHRoZSBjb21wbGV0ZSByZXNwb25zZSBhbmQgdXBkYXRlIHRoZSBlZGl0b3Igb25jZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFpUHJvbXB0ID0gYXdhaXQgdGhpcy5wcm9tcHRTZXJ2aWNlLmdlbmVyYXRlUHJvbXB0KHBhc3RFbnRyaWVzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3LmVkaXRvci5zZXRWYWx1ZSh2aWV3LmVkaXRvci5nZXRWYWx1ZSgpICsgYWlQcm9tcHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBBZGQgdGhlIHJlc3BvbnNlIHNlY3Rpb24gYWZ0ZXIgdGhlIHByb21wdFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmluYWxDb250ZW50ID0gdmlldy5lZGl0b3IuZ2V0VmFsdWUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpZXcuZWRpdG9yLnNldFZhbHVlKGZpbmFsQ29udGVudCArICdcXG5cXG4jIyBZb3VyIEpvdXJuYWwgUmVzcG9uc2VcXG5cXG4nKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgbG9hZGluZ05vdGljZS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoJ0NyZWF0ZWQgbmV3IGpvdXJuYWwgZW50cnkgZm9yIHRvZGF5Jyk7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3IE5vdGljZSgnRXJyb3IgZ2VuZXJhdGluZyBwcm9tcHQ6ICcgKyBlcnJvci5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIGVtcHR5IHJlc3BvbnNlIHNlY3Rpb24gaWYgcHJvbXB0IGdlbmVyYXRpb24gZmFpbHNcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmlldyA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVWaWV3T2ZUeXBlKE1hcmtkb3duVmlldyk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2aWV3KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2aWV3LmVkaXRvci5zZXRWYWx1ZSh2aWV3LmVkaXRvci5nZXRWYWx1ZSgpICsgJ1xcblxcbiMjIFlvdXIgSm91cm5hbCBSZXNwb25zZVxcblxcbicpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBsZWFmID0gdGhpcy5hcHAud29ya3NwYWNlLmdldExlYWYoZmFsc2UpO1xuICAgICAgICAgICAgICAgIGF3YWl0IGxlYWYub3BlbkZpbGUoZmlsZSBhcyBURmlsZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoJ0Vycm9yIG9wZW5pbmcgdG9kYXlcXCdzIGpvdXJuYWw6ICcgKyBlcnJvci5tZXNzYWdlKTtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIG9wZW5pbmcgdG9kYXlcXCdzIGpvdXJuYWw6JywgZXJyb3IpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXN5bmMgc3VtbWFyaXplSm91cm5hbGluZ1Nlc3Npb24oKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGNvbnN0IGFjdGl2ZVZpZXcgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlVmlld09mVHlwZShNYXJrZG93blZpZXcpO1xuICAgICAgICBpZiAoIWFjdGl2ZVZpZXcpIHtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoJ1BsZWFzZSBvcGVuIGEgbm90ZSBmaXJzdCcpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFhY3RpdmVWaWV3LmZpbGUpIHtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoJ05vIGZpbGUgaXMgY3VycmVudGx5IG9wZW4nKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBTYXZlIG9yaWdpbmFsIGNvbnRlbnQgdG8gaW5wdXRzIGZvbGRlclxuICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxDb250ZW50ID0gYWN0aXZlVmlldy5lZGl0b3IuZ2V0VmFsdWUoKTtcbiAgICAgICAgICAgIGNvbnN0IGZpbGVOYW1lID0gYWN0aXZlVmlldy5maWxlLm5hbWU7XG4gICAgICAgICAgICBjb25zdCBpbnB1dFBhdGggPSBgJHt0aGlzLnNldHRpbmdzLmlucHV0c0ZvbGRlcn0vJHtmaWxlTmFtZX1gO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBhd2FpdCB0aGlzLmVuc3VyZUZvbGRlcih0aGlzLnNldHRpbmdzLmlucHV0c0ZvbGRlcik7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGUoaW5wdXRQYXRoLCBvcmlnaW5hbENvbnRlbnQpO1xuXG4gICAgICAgICAgICAvLyBQcm9jZXNzIGNvbnRlbnQgKHRyYW5zY3JpYmUgcmVjb3JkaW5ncyBpZiBhbnkpXG4gICAgICAgICAgICBsZXQgcHJvY2Vzc2VkQ29udGVudCA9IGF3YWl0IHRoaXMucHJvY2Vzc0NvbnRlbnQob3JpZ2luYWxDb250ZW50KTtcblxuICAgICAgICAgICAgLy8gRXh0cmFjdCB1c2VyJ3MgcmVzcG9uc2Ugc2VjdGlvblxuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2VNYXRjaCA9IHByb2Nlc3NlZENvbnRlbnQubWF0Y2goLyMjIFlvdXIgSm91cm5hbCBSZXNwb25zZVxcblxcbihbXFxzXFxTXSokKS8pO1xuICAgICAgICAgICAgaWYgKCFyZXNwb25zZU1hdGNoKSB7XG4gICAgICAgICAgICAgICAgbmV3IE5vdGljZSgnQ291bGQgbm90IGZpbmQgam91cm5hbCByZXNwb25zZSBzZWN0aW9uJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCB1c2VyUmVzcG9uc2UgPSByZXNwb25zZU1hdGNoWzFdO1xuICAgICAgICAgICAgbGV0IHN1bW1hcnk6IHN0cmluZztcblxuICAgICAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3MudXNlU3RyZWFtaW5nUmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgYSB0ZW1wb3JhcnkgdmFyaWFibGUgdG8gc3RvcmUgdGhlIHN0cmVhbWVkIHN1bW1hcnlcbiAgICAgICAgICAgICAgICBsZXQgc3RyZWFtZWRTdW1tYXJ5ID0gJyc7XG4gICAgICAgICAgICAgICAgc3VtbWFyeSA9IGF3YWl0IHRoaXMuc3VtbWFyaXphdGlvblNlcnZpY2Uuc3VtbWFyaXplKFxuICAgICAgICAgICAgICAgICAgICB1c2VyUmVzcG9uc2UsXG4gICAgICAgICAgICAgICAgICAgIHRydWUsXG4gICAgICAgICAgICAgICAgICAgIChjaHVuaykgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RyZWFtZWRTdW1tYXJ5ICs9IGNodW5rO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBlZGl0b3IgaW4gcmVhbC10aW1lIHdpdGggdGhlIHBhcnRpYWwgc3VtbWFyeVxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlZENvbnRlbnQgPSBwcm9jZXNzZWRDb250ZW50LnJlcGxhY2UoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLyMjIFlvdXIgSm91cm5hbCBSZXNwb25zZVxcblxcbltcXHNcXFNdKiQvLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAjIyBZb3VyIEpvdXJuYWwgUmVzcG9uc2VcXG5cXG4ke3N0cmVhbWVkU3VtbWFyeX1gXG4gICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlVmlldy5lZGl0b3Iuc2V0VmFsdWUodXBkYXRlZENvbnRlbnQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gR2V0IHRoZSBjb21wbGV0ZSBzdW1tYXJ5IGF0IG9uY2VcbiAgICAgICAgICAgICAgICBzdW1tYXJ5ID0gYXdhaXQgdGhpcy5zdW1tYXJpemF0aW9uU2VydmljZS5zdW1tYXJpemUodXNlclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBub3RlIHdpdGggdGhlIGZpbmFsIHN1bW1hcnlcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRDb250ZW50ID0gcHJvY2Vzc2VkQ29udGVudC5yZXBsYWNlKFxuICAgICAgICAgICAgICAgIC8jIyBZb3VyIEpvdXJuYWwgUmVzcG9uc2VcXG5cXG5bXFxzXFxTXSokLyxcbiAgICAgICAgICAgICAgICBgIyMgWW91ciBKb3VybmFsIFJlc3BvbnNlXFxuXFxuJHtzdW1tYXJ5fWBcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGFjdGl2ZVZpZXcuZWRpdG9yLnNldFZhbHVlKHVwZGF0ZWRDb250ZW50KTtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoJ0pvdXJuYWwgc2Vzc2lvbiBzdW1tYXJpemVkJyk7XG5cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoYEVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdTdW1tYXJpemF0aW9uIGVycm9yOicsIGVycm9yKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgcHJvY2Vzc0NvbnRlbnQoY29udGVudDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAgICAgY29uc3QgcmVjb3JkaW5nUGF0dGVybiA9IFRyYW5zY3JpcHRpb25TZXJ2aWNlLmdldFJlY29yZGluZ0VtYmVkUGF0dGVybigpO1xuICAgICAgICBjb25zdCByZWNvcmRpbmdzID0gY29udGVudC5tYXRjaChyZWNvcmRpbmdQYXR0ZXJuKTtcblxuICAgICAgICBpZiAoIXJlY29yZGluZ3MpIHJldHVybiBjb250ZW50O1xuXG4gICAgICAgIGxldCBwcm9jZXNzZWRDb250ZW50ID0gY29udGVudDtcblxuICAgICAgICBmb3IgKGNvbnN0IHJlY29yZGluZyBvZiByZWNvcmRpbmdzKSB7XG4gICAgICAgICAgICBjb25zdCBmaWxlTmFtZSA9IHJlY29yZGluZy5zbGljZSgzLCAtMik7XG4gICAgICAgICAgICBjb25zdCBmaWxlID0gdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaXJzdExpbmtwYXRoRGVzdChmaWxlTmFtZSwgXCJcIik7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0cmFuc2NyaXB0ID0gYXdhaXQgdGhpcy53aGlzcGVyU2VydmljZS50cmFuc2NyaWJlRmlsZShmaWxlKTtcbiAgICAgICAgICAgICAgICBwcm9jZXNzZWRDb250ZW50ID0gcHJvY2Vzc2VkQ29udGVudC5yZXBsYWNlKHJlY29yZGluZywgdHJhbnNjcmlwdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcHJvY2Vzc2VkQ29udGVudDtcbiAgICB9XG5cbiAgICBhc3luYyBjaGF0V2l0aEFJKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBhY3RpdmVWaWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KTtcbiAgICAgICAgaWYgKCFhY3RpdmVWaWV3KSB7XG4gICAgICAgICAgICBuZXcgTm90aWNlKCdQbGVhc2Ugb3BlbiBhIG5vdGUgZmlyc3QnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIDEpIFRyYW5zY3JpYmUgYW55IGF1ZGlvIHJlY29yZGluZ3MgaW4gdGhlIG5vdGVcbiAgICAgICAgYXdhaXQgdGhpcy50cmFuc2NyaXB0aW9uU2VydmljZS50cmFuc2NyaWJlUmVjb3JkaW5ncygpO1xuXG4gICAgICAgIC8vIDIpIFJldHJpZXZlIHVwZGF0ZWQgY29udGVudFxuICAgICAgICBjb25zdCBjb250ZW50ID0gYWN0aXZlVmlldy5lZGl0b3IuZ2V0VmFsdWUoKTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gMykgUGFzcyB0aGUgdGV4dCB0byBDaGF0U2VydmljZVxuICAgICAgICAgICAgY29uc3QgY2hhdFJlc3BvbnNlID0gYXdhaXQgdGhpcy5jaGF0U2VydmljZS5jaGF0KGNvbnRlbnQpO1xuXG4gICAgICAgICAgICAvLyA0KSBBcHBlbmQgdGhlIEFJXHUyMDE5cyByZXBseVxuICAgICAgICAgICAgYWN0aXZlVmlldy5lZGl0b3Iuc2V0VmFsdWUoXG4gICAgICAgICAgICAgICAgY29udGVudCArICdcXG5cXG4jIyBBSSBDaGF0XFxuXFxuJyArIGNoYXRSZXNwb25zZVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgbmV3IE5vdGljZSgnQUkgcmVzcG9uZGVkIGluIG5vdGUnKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgICAgICAgbmV3IE5vdGljZShgRXJyb3IgZHVyaW5nIGNoYXQ6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgICAgfVxuICAgIH1cbn0gIiwgImltcG9ydCB7IE5vdGljZSwgTWFya2Rvd25WaWV3LCBURmlsZSwgVmF1bHQgfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgeyBXaGlzcGVyU2VydmljZSB9IGZyb20gJy4vV2hpc3BlclNlcnZpY2UnO1xuaW1wb3J0IHR5cGUgeyBBcHAgfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgdHlwZSB7IEpvdXJuYWxpbmdBc3Npc3RhbnRTZXR0aW5ncyB9IGZyb20gJy4uL3R5cGVzJztcblxuZXhwb3J0IGNsYXNzIFRyYW5zY3JpcHRpb25TZXJ2aWNlIHtcbiAgICBwcml2YXRlIHdoaXNwZXJTZXJ2aWNlOiBXaGlzcGVyU2VydmljZTtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIGFwcDogQXBwLFxuICAgICAgICBwcml2YXRlIHNldHRpbmdzOiBKb3VybmFsaW5nQXNzaXN0YW50U2V0dGluZ3NcbiAgICApIHtcbiAgICAgICAgdGhpcy53aGlzcGVyU2VydmljZSA9IG5ldyBXaGlzcGVyU2VydmljZSh0aGlzLmFwcC52YXVsdCwgdGhpcy5zZXR0aW5ncy5vcGVuQUlBcGlLZXkpO1xuICAgIH1cblxuICAgIHVwZGF0ZVNldHRpbmdzKHNldHRpbmdzOiBKb3VybmFsaW5nQXNzaXN0YW50U2V0dGluZ3MpIHtcbiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IHNldHRpbmdzO1xuICAgICAgICB0aGlzLndoaXNwZXJTZXJ2aWNlLnNldEFwaUtleShzZXR0aW5ncy5vcGVuQUlBcGlLZXkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiB0aGUgZmlsZSBmb3JtYXQgaXMgZGlyZWN0bHkgc3VwcG9ydGVkIGJ5IFdoaXNwZXIgQVBJXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBpc1N1cHBvcnRlZEZvcm1hdChmaWxlOiBURmlsZSk6IGJvb2xlYW4ge1xuICAgICAgICBjb25zdCBzdXBwb3J0ZWRGb3JtYXRzID0gWydmbGFjJywgJ21wMycsICdtcDQnLCAnbXBlZycsICdtcGdhJywgJ200YScsICdvZ2cnLCAnd2F2JywgJ3dlYm0nXTtcbiAgICAgICAgY29uc3QgZXh0ZW5zaW9uID0gZmlsZS5leHRlbnNpb24udG9Mb3dlckNhc2UoKTtcbiAgICAgICAgcmV0dXJuIHN1cHBvcnRlZEZvcm1hdHMuaW5jbHVkZXMoZXh0ZW5zaW9uKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQcmVwYXJlcyBhdWRpbyBmaWxlIGZvciB0cmFuc2NyaXB0aW9uXG4gICAgICovXG4gICAgcHJpdmF0ZSBhc3luYyBwcmVwYXJlQXVkaW9Gb3JUcmFuc2NyaXB0aW9uKGZpbGU6IFRGaWxlKTogUHJvbWlzZTx7IGJsb2I6IEJsb2I7IG1pbWVUeXBlOiBzdHJpbmcgfT4ge1xuICAgICAgICBjb25zdCBhcnJheUJ1ZmZlciA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWRCaW5hcnkoZmlsZSk7XG4gICAgICAgIGNvbnN0IGV4dGVuc2lvbiA9IGZpbGUuZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBtaW1lVHlwZXM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0gPSB7XG4gICAgICAgICAgICAnZmxhYyc6ICdhdWRpby9mbGFjJyxcbiAgICAgICAgICAgICdtcDMnOiAnYXVkaW8vbXBlZycsXG4gICAgICAgICAgICAnbXA0JzogJ2F1ZGlvL21wNCcsXG4gICAgICAgICAgICAnbXBlZyc6ICdhdWRpby9tcGVnJyxcbiAgICAgICAgICAgICdtcGdhJzogJ2F1ZGlvL21wZWcnLFxuICAgICAgICAgICAgJ200YSc6ICdhdWRpby9tcDQnLFxuICAgICAgICAgICAgJ29nZyc6ICdhdWRpby9vZ2cnLFxuICAgICAgICAgICAgJ3dhdic6ICdhdWRpby93YXYnLFxuICAgICAgICAgICAgJ3dlYm0nOiAnYXVkaW8vd2VibSdcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBtaW1lVHlwZSA9IG1pbWVUeXBlc1tleHRlbnNpb25dO1xuICAgICAgICBpZiAoIW1pbWVUeXBlKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuc3VwcG9ydGVkIE1JTUUgdHlwZSBmb3IgZXh0ZW5zaW9uOiAke2V4dGVuc2lvbn1gKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBibG9iOiBuZXcgQmxvYihbYXJyYXlCdWZmZXJdLCB7IHR5cGU6IG1pbWVUeXBlIH0pLFxuICAgICAgICAgICAgbWltZVR5cGVcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgUmVnRXhwIHBhdHRlcm4gdGhhdCBtYXRjaGVzIE9ic2lkaWFuJ3MgZW1iZWQgc3ludGF4IGZvciBzdXBwb3J0ZWQgYXVkaW8gZm9ybWF0c1xuICAgICAqL1xuICAgIHN0YXRpYyBnZXRSZWNvcmRpbmdFbWJlZFBhdHRlcm4oKTogUmVnRXhwIHtcbiAgICAgICAgcmV0dXJuIC8hXFxbXFxbLitcXC4oZmxhY3xtcDN8bXA0fG1wZWd8bXBnYXxtNGF8b2dnfHdhdnx3ZWJtKVxcXVxcXS9nO1xuICAgIH1cblxuICAgIGFzeW5jIHRyYW5zY3JpYmVSZWNvcmRpbmdzKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBhY3RpdmVWaWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KTtcbiAgICAgICAgaWYgKCFhY3RpdmVWaWV3KSB7XG4gICAgICAgICAgICBuZXcgTm90aWNlKCdQbGVhc2Ugb3BlbiBhIG5vdGUgZmlyc3QnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdGhpcy5zZXR0aW5ncy5vcGVuQUlBcGlLZXkpIHtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoJ09wZW5BSSBBUEkga2V5IG5vdCBjb25maWd1cmVkJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBlZGl0b3IgPSBhY3RpdmVWaWV3LmVkaXRvcjtcbiAgICAgICAgY29uc3QgY29udGVudCA9IGVkaXRvci5nZXRWYWx1ZSgpO1xuICAgICAgICBjb25zdCByZWNvcmRpbmdQYXR0ZXJuID0gVHJhbnNjcmlwdGlvblNlcnZpY2UuZ2V0UmVjb3JkaW5nRW1iZWRQYXR0ZXJuKCk7XG4gICAgICAgIGNvbnN0IHJlY29yZGluZ3MgPSBjb250ZW50Lm1hdGNoKHJlY29yZGluZ1BhdHRlcm4pO1xuXG4gICAgICAgIGlmICghcmVjb3JkaW5ncyB8fCByZWNvcmRpbmdzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgbmV3IE5vdGljZSgnTm8gcmVjb3JkaW5ncyBmb3VuZCBpbiB0aGUgY3VycmVudCBub3RlJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBuZXcgTm90aWNlKCdTdGFydGluZyB0cmFuc2NyaXB0aW9uLi4uJyk7XG5cbiAgICAgICAgbGV0IHVwZGF0ZWRDb250ZW50ID0gY29udGVudDtcbiAgICAgICAgbGV0IGhhc0Vycm9ycyA9IGZhbHNlO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHJlY29yZGluZyBvZiByZWNvcmRpbmdzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZmlsZU5hbWUgPSByZWNvcmRpbmcuc2xpY2UoMywgLTIpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpcnN0TGlua3BhdGhEZXN0KGZpbGVOYW1lLCBcIlwiKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAoIShmaWxlIGluc3RhbmNlb2YgVEZpbGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoYENvdWxkIG5vdCBmaW5kIGZpbGU6ICR7ZmlsZU5hbWV9YCk7XG4gICAgICAgICAgICAgICAgICAgIGhhc0Vycm9ycyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zY3JpcHQgPSBhd2FpdCB0aGlzLndoaXNwZXJTZXJ2aWNlLnRyYW5zY3JpYmVGaWxlKGZpbGUpO1xuICAgICAgICAgICAgICAgICAgICB1cGRhdGVkQ29udGVudCA9IHVwZGF0ZWRDb250ZW50LnJlcGxhY2UocmVjb3JkaW5nLCB0cmFuc2NyaXB0KTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBuZXcgTm90aWNlKGBGYWlsZWQgdG8gdHJhbnNjcmliZSAke2ZpbGVOYW1lfTogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgICAgICAgICAgICAgICBoYXNFcnJvcnMgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVkaXRvci5zZXRWYWx1ZSh1cGRhdGVkQ29udGVudCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChoYXNFcnJvcnMpIHtcbiAgICAgICAgICAgICAgICBuZXcgTm90aWNlKCdUcmFuc2NyaXB0aW9uIGNvbXBsZXRlZCB3aXRoIHNvbWUgZXJyb3JzJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoJ1RyYW5zY3JpcHRpb24gY29tcGxldGVkIHN1Y2Nlc3NmdWxseScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgbmV3IE5vdGljZShgVHJhbnNjcmlwdGlvbiBmYWlsZWQ6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1RyYW5zY3JpcHRpb24gZXJyb3I6JywgZXJyb3IpO1xuICAgICAgICB9XG4gICAgfVxufSAiLCAiaW1wb3J0IHsgVEZpbGUsIFZhdWx0IH0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0IHsgVHJhbnNjcmlwdGlvblNlcnZpY2UgfSBmcm9tICcuL1RyYW5zY3JpcHRpb25TZXJ2aWNlJztcblxuZXhwb3J0IGNsYXNzIFdoaXNwZXJTZXJ2aWNlIHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSB2YXVsdDogVmF1bHQsXG4gICAgICAgIHByaXZhdGUgYXBpS2V5OiBzdHJpbmdcbiAgICApIHt9XG5cbiAgICBzZXRBcGlLZXkoYXBpS2V5OiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5hcGlLZXkgPSBhcGlLZXk7XG4gICAgfVxuXG4gICAgYXN5bmMgdHJhbnNjcmliZUZpbGUoYXVkaW9GaWxlOiBURmlsZSk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuYXBpS2V5KSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdPcGVuQUkgQVBJIGtleSBpcyByZXF1aXJlZCBmb3IgdHJhbnNjcmlwdGlvbicpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIVRyYW5zY3JpcHRpb25TZXJ2aWNlLmlzU3VwcG9ydGVkRm9ybWF0KGF1ZGlvRmlsZSkpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuc3VwcG9ydGVkIGF1ZGlvIGZvcm1hdDogJHthdWRpb0ZpbGUuZXh0ZW5zaW9ufWApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCB0aGlzLnZhdWx0LnJlYWRCaW5hcnkoYXVkaW9GaWxlKTtcbiAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbYXJyYXlCdWZmZXJdLCB7IHR5cGU6IGBhdWRpby8ke2F1ZGlvRmlsZS5leHRlbnNpb259YCB9KTtcbiAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnZmlsZScsIGJsb2IsIGAke2F1ZGlvRmlsZS5iYXNlbmFtZX0uJHthdWRpb0ZpbGUuZXh0ZW5zaW9ufWApO1xuICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdtb2RlbCcsICd3aGlzcGVyLTEnKTtcblxuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgnaHR0cHM6Ly9hcGkub3BlbmFpLmNvbS92MS9hdWRpby90cmFuc2NyaXB0aW9ucycsIHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogYEJlYXJlciAke3RoaXMuYXBpS2V5fWBcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGJvZHk6IGZvcm1EYXRhLFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlcnJvciA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3IuZXJyb3I/Lm1lc3NhZ2UgfHwgJ1RyYW5zY3JpcHRpb24gZmFpbGVkJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQudGV4dDtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1RyYW5zY3JpcHRpb24gZXJyb3I6JywgZXJyb3IpO1xuICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICB9XG59ICIsICJpbXBvcnQgeyBOb3RpY2UgfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgeyBPcGVuQUlTZXJ2aWNlIH0gZnJvbSAnLi9PcGVuQUlTZXJ2aWNlJztcbmltcG9ydCBzdW1tYXJ5UHJvbXB0IGZyb20gJy4uL3Byb21wdHMvc3VtbWFyeVByb21wdCc7XG5cbmV4cG9ydCBjbGFzcyBTdW1tYXJpemF0aW9uU2VydmljZSB7XG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBvcGVuQUlTZXJ2aWNlOiBPcGVuQUlTZXJ2aWNlKSB7fVxuXG4gICAgLyoqXG4gICAgICogVGFrZXMgdGhlIHVzZXIncyBqb3VybmFsIHJlc3BvbnNlIGFuZCByZXR1cm5zIGEgc3VtbWFyeVxuICAgICAqIEBwYXJhbSBjb250ZW50IFRoZSBjb250ZW50IHRvIHN1bW1hcml6ZVxuICAgICAqIEBwYXJhbSB1c2VTdHJlYW1pbmcgV2hldGhlciB0byBzdHJlYW0gdGhlIHJlc3BvbnNlXG4gICAgICogQHBhcmFtIG9uQ2h1bmsgT3B0aW9uYWwgY2FsbGJhY2sgZm9yIHN0cmVhbWluZyByZXNwb25zZXNcbiAgICAgKi9cbiAgICBhc3luYyBzdW1tYXJpemUoXG4gICAgICAgIGNvbnRlbnQ6IHN0cmluZywgXG4gICAgICAgIHVzZVN0cmVhbWluZzogYm9vbGVhbiA9IGZhbHNlLFxuICAgICAgICBvbkNodW5rPzogKGNodW5rOiBzdHJpbmcpID0+IHZvaWRcbiAgICApOiBQcm9taXNlPHN0cmluZz4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcHJvbXB0ID0gYCR7c3VtbWFyeVByb21wdH1cXG5cXG4ke2NvbnRlbnR9YDtcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLm9wZW5BSVNlcnZpY2UubWFrZU9wZW5BSVJlcXVlc3QoXG4gICAgICAgICAgICAgICAgcHJvbXB0LCBcbiAgICAgICAgICAgICAgICB1c2VTdHJlYW1pbmcgPyBvbkNodW5rIDogdW5kZWZpbmVkXG4gICAgICAgICAgICApO1xuICAgICAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgICAgICBuZXcgTm90aWNlKGBFcnJvciBkdXJpbmcgc3VtbWFyaXphdGlvbjogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICB9XG59ICIsICIvKipcbiAqIFByb21wdCBmb3Igc3VtbWFyaXppbmcgam91cm5hbCBlbnRyaWVzXG4gKiBFeHRyYWN0cyBrZXkgaW5zaWdodHMsIHBhdHRlcm5zLCBhbmQgbWVhbmluZ2Z1bCByZWZsZWN0aW9uc1xuICogZnJvbSB0aGUgdXNlcidzIGpvdXJuYWxpbmcgc2Vzc2lvbi5cbiAqL1xuZXhwb3J0IGRlZmF1bHQgYEFzIGEgam91cm5hbGluZyBhc3Npc3RhbnQsIGFuYWx5emUgdGhpcyBqb3VybmFsIGVudHJ5IGFuZCBjcmVhdGUgYSBjb25jaXNlIHN1bW1hcnkgdGhhdDpcblxuMS4gSWRlbnRpZmllcyB0aGUgbWFpbiB0aGVtZXMgYW5kIGluc2lnaHRzXG4yLiBIaWdobGlnaHRzIGtleSByZWFsaXphdGlvbnMgb3IgYnJlYWt0aHJvdWdoc1xuMy4gTm90ZXMgYW55IGFjdGlvbiBpdGVtcyBvciBpbnRlbnRpb25zIGV4cHJlc3NlZFxuNC4gUHJlc2VydmVzIHRoZSBlbW90aW9uYWwgdG9uZSBvZiB0aGUgZW50cnlcblxuRm9jdXMgb24gZXh0cmFjdGluZyB0aGUgbW9zdCBtZWFuaW5nZnVsIGVsZW1lbnRzIHdoaWxlIG1haW50YWluaW5nIHRoZSBwZXJzb25hbCBuYXR1cmUgb2YgdGhlIHJlZmxlY3Rpb24uYDsgIiwgImltcG9ydCB7IE9wZW5BSVNlcnZpY2UgfSBmcm9tICcuL09wZW5BSVNlcnZpY2UnO1xuaW1wb3J0IHsgTm90aWNlIH0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0IGpvdXJuYWxQcm9tcHQgZnJvbSAnLi4vcHJvbXB0cy9qb3VybmFsUHJvbXB0JztcblxuZXhwb3J0IGNsYXNzIFByb21wdFNlcnZpY2Uge1xuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgb3BlbkFJU2VydmljZTogT3BlbkFJU2VydmljZSkge31cblxuICAgIC8qKlxuICAgICAqIEdlbmVyYXRlcyBhIGpvdXJuYWwgcHJvbXB0IGJhc2VkIG9uIHBhc3QgZW50cmllc1xuICAgICAqIEBwYXJhbSBwYXN0RW50cmllcyBBcnJheSBvZiBwYXN0IGpvdXJuYWwgZW50cmllc1xuICAgICAqIEBwYXJhbSBvbkNodW5rIE9wdGlvbmFsIGNhbGxiYWNrIGZvciBzdHJlYW1pbmcgcmVzcG9uc2VzXG4gICAgICovXG4gICAgYXN5bmMgZ2VuZXJhdGVQcm9tcHQocGFzdEVudHJpZXM6IHN0cmluZ1tdLCBvbkNodW5rPzogKGNodW5rOiBzdHJpbmcpID0+IHZvaWQpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcGFzdEVudHJpZXNUZXh0ID0gcGFzdEVudHJpZXMubGVuZ3RoID4gMCBcbiAgICAgICAgICAgICAgICA/IGBQYXN0IEVudHJpZXM6XFxuXFxuJHtwYXN0RW50cmllcy5qb2luKCdcXG5cXG4tLS1cXG5cXG4nKX1gXG4gICAgICAgICAgICAgICAgOiAnTm8gcGFzdCBlbnRyaWVzIGF2YWlsYWJsZS4nO1xuXG4gICAgICAgICAgICBjb25zdCBwcm9tcHQgPSBgJHtqb3VybmFsUHJvbXB0fVxcblxcbiR7cGFzdEVudHJpZXNUZXh0fWA7XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5vcGVuQUlTZXJ2aWNlLm1ha2VPcGVuQUlSZXF1ZXN0KHByb21wdCwgb25DaHVuayk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoYEVycm9yIGdlbmVyYXRpbmcgcHJvbXB0OiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgIH1cbn0gIiwgIi8qKlxuICogUHJvbXB0IGZvciBnZW5lcmF0aW5nIGRhaWx5IGpvdXJuYWxpbmcgcHJvbXB0c1xuICogVGFrZXMgaW50byBhY2NvdW50IHBhc3Qgam91cm5hbCBlbnRyaWVzIHRvIGNyZWF0ZSBjb250ZXh0dWFsIGFuZCBtZWFuaW5nZnVsIHByb21wdHNcbiAqIHRoYXQgZW5jb3VyYWdlIHNlbGYtcmVmbGVjdGlvbiBhbmQgcGVyc29uYWwgZ3Jvd3RoLlxuICovXG4vLyBleHBvcnQgZGVmYXVsdCBgWW91J3JlIGEgZnJpZW5kbHkgam91cm5hbGluZyBndWlkZS4gWW91IHdpbGwgZ2VuZXJhdGUgYSBwcm9tcHQgZm9yIGEgZGFpbHkgam91cm5hbCBiYXNlZCBvbiBpbnN0cnVjdGlvbnMgdGhhdCBJIG91dGxpbmUgYmVsb3cuXG5cbi8vICMjIE92ZXJhbGwgU3RydWN0dXJlXG4vLyBUaGUgZmluYWwgb3V0cHV0IHNob3VsZCBjb250YWluIHR3byBzZWN0aW9uczpcblxuLy8gMS4gUmVjYXAgb2YgcGFzdCBlbnRyaWVzOiBBIGJyaWVmLCBmcmllbmRseSBzdW1tYXJ5IGhpZ2hsaWdodGluZyByZWN1cnJpbmcgdGhlbWVzLCBlbW90aW9ucywgb3IgaW1wb3J0YW50IGluc2lnaHRzIGZyb20gcHJldmlvdXMgZGF5c1x1MjAxOSBqb3VybmFsIGVudHJpZXMuXG4vLyAyLiBUb2RheVx1MjAxOXMgUHJvbXB0OiBBIHNldCBvZiBvcGVuLWVuZGVkLCBmcmllbmRseSBxdWVzdGlvbnMgdGhhdCBlbmNvdXJhZ2UgZGVlcGVyIHNlbGYtcmVmbGVjdGlvbiBvbiB0aGUgdXNlclx1MjAxOXMgY3VycmVudCBmZWVsaW5ncywgc2lnbmlmaWNhbnQgZXZlbnRzLCBncmF0aXR1ZGUsIGNvbnRpbnVpdHkgZnJvbSBwYXN0IGVudHJpZXMsIGFuZCBjcmVhdGl2ZSBwZXJzcGVjdGl2ZXMuXG5cbi8vICMjIENvbnRlbnQgR3VpZGVsaW5lc1xuXG4vLyAtIFJlY2FwIG9mIHBhc3QgZW50cmllcyAoYnJpZWYgYW5kIGhlbHBmdWwsIHdyaXR0ZW4gaW4gYSBzZWNvbmQgcGVyc29uKVxuLy8gICAgLSBQcm92aWRlIGEgY29uY2lzZSBvdXRsaW5lIG9mIGtleSBwb2ludHMgZnJvbSBwcmV2aW91cyBqb3VybmFsIGVudHJpZXMuXG4vLyAgICAtIEhpZ2hsaWdodCByZWN1cnJpbmcgZW1vdGlvbnMsIHBhdHRlcm5zLCBvciB0aGVtZXMgdGhhdCBoYXZlIHN1cmZhY2VkLlxuLy8gICAgLSBNZW50aW9uIHBvc2l0aXZlIGRldmVsb3BtZW50cywgY2hhbGxlbmdlcywgb3Igbm90YWJsZSBzaGlmdHMgaW4gcGVyc3BlY3RpdmUuXG4vLyAtIFRvZGF5XHUyMDE5cyBQcm9tcHQgKHNwZWNpZmljLCBvcGVuLWVuZGVkLCBhbmQgdXNlci1kcml2ZW4pXG4vLyAgICAtIEJlZ2luIHdpdGggcXVlc3Rpb25zIGFib3V0IHRoZSB1c2VyXHUyMDE5cyBjdXJyZW50IGVtb3Rpb25zIGFuZCB3ZWxsLWJlaW5nIChhcHByb3guIDMgcXVlc3Rpb25zKS5cbi8vICAgIC0gSW5jbHVkZSBxdWVzdGlvbnMgdGhhdCBoZWxwIHRoZSB1c2VyIHJlZmxlY3Qgb24gaW1wb3J0YW50IGV2ZW50cywgc291cmNlcyBvZiBncmF0aXR1ZGUsIGFuZCBlbW90aW9uYWwgaGlnaHMgYW5kIGxvd3MgZnJvbSB0b2RheSAoYXBwcm94LiAzIHF1ZXN0aW9ucykuXG4vLyAgICAtIEFkZCBxdWVzdGlvbnMgdGhhdCByZWZlcmVuY2UgdGhlIHVzZXJcdTIwMTlzIHByZXZpb3VzIGVudHJpZXMgdG8gZW5jb3VyYWdlIG5vdGljaW5nIHBhdHRlcm5zIG9yIGNoYW5nZXMgb3ZlciB0aW1lIChhcHByb3guIDIgcXVlc3Rpb25zKS5cbi8vICAgIC0gSW5jb3Jwb3JhdGUgY3JlYXRpdmUgb3IgaW1hZ2luYXRpdmUgcXVlc3Rpb25zIHRoYXQgb2ZmZXIgZnJlc2ggcGVyc3BlY3RpdmVzLCBzdWNoIGFzIHZpc3VhbGl6aW5nIGZ1dHVyZSBvdXRjb21lcyBvciBleHBsb3JpbmcgaHlwb3RoZXRpY2FsIHNjZW5hcmlvcyAoYXBwcm94LiAyIHF1ZXN0aW9ucykuXG5cbi8vICMjIFRvbmUgYW5kIFN0eWxlXG5cbi8vIC0gQmUgZnJpZW5kbHksIHdhcm0sIGFuZCBlbXBhdGhldGljXHUyMDE0bGlrZSBhIHRydXN0ZWQgZnJpZW5kLlxuLy8gLSBLZWVwIHRoZSBsYW5ndWFnZSBjb25jaXNlLCBjbGVhciwgYW5kIHN1cHBvcnRpdmUuXG4vLyAtIEF2b2lkIHN0ZWVyaW5nIHRoZSB1c2VyIHRvd2FyZCBzcGVjaWZpYyBlbW90aW9ucyBvciBjb25jbHVzaW9uczsgYWxsb3cgdGhlbSB0byBleHBsb3JlIHRoZWlyIG93biB0aG91Z2h0cyBhbmQgZmVlbGluZ3MuXG4vLyAtIFVzZSBidWxsZXQgcG9pbnRzIGZvciB0aGUgcXVlc3Rpb25zIHRvIG1haW50YWluIGNsYXJpdHkgYW5kIGVhc3kgcmVhZGFiaWxpdHkuXG5cbi8vICMjIEZpbmFsIE91dHB1dCBGb3JtYXRcbi8vIFRoZSBmaW5hbCBzdHJ1Y3R1cmUgc2hvdWxkIGxvb2sgbGlrZSB0aGlzOlxuXG4vLyAjIyBSZWNhcCBvZiBwYXN0IGVudHJpZXNcbi8vIDxvdXRsaW5lIG9mIHBhc3QgZW50cmllcz5cblxuLy8gIyMgVG9kYXkncyBQcm9tcHRcbi8vIDxwcm9tcHQ+XG4vLyBgOyBcblxuZXhwb3J0IGRlZmF1bHQgYEFzIGEgZnJpZW5kbHkgam91cm5hbGluZyBndWlkZSwgYW5hbHl6ZSB0aGVzZSBwYXN0IGpvdXJuYWwgZW50cmllcyBhbmQgY3JlYXRlIGEgdGhvdWdodC1wcm92b2tpbmcgcHJvbXB0IFxudGhhdCBlbmNvdXJhZ2VzIGRlZXBlciBzZWxmLXJlZmxlY3Rpb24gd2hpbGUgbWFpbnRhaW5pbmcgY29udGludWl0eSB3aXRoIHByZXZpb3VzIHRoZW1lcyBhbmQgaW5zaWdodHMuIFxuV3JpdGUgdGhlIG91dGxpbmUgaW4gYSBzZWNvbmQgcGVyc29uLCB0aGUgdXNlciBzaG91bGQgZmVlbCBsaWtlIHRoZXkgYXJlIHRhbGtpbmcgdG8gYSBmcmllbmQuXG5cbkJlZm9yZSB0aGUgcHJvbXB0OlxuMS4gT3V0bGluZSB0aGUgYXNwZWN0cyBvZiBwYXN0IGVudHJpZXMgdG8gYWxsb3cgZm9yIGJldHRlciBzZWxmLXJlZmxlY3Rpb24sIG9ubHkgaWYgdGhlcmUgYXJlIHBhc3QgZW50cmllcy5cbjIuIERvbid0IG1ha2UgdXAgaW5mb3JtYXRpb24sIG9ubHkgdXNlIHRoZSBpbmZvcm1hdGlvbiB0aGF0IGlzIHByb3ZpZGVkIGluIHRoZSBwYXN0IGVudHJpZXMuXG4zLiBLZWVwIGEgZnJpZW5kbHkgdG9uZSwgdGhlIHVzZXIgc2hvdWxkIGZlZWwgbGlrZSB0aGV5IGFyZSB0YWxraW5nIHRvIGEgZnJpZW5kXG40LiBCZSBjb25jaXNlIGFuZCB0byB0aGUgcG9pbnRcbjUuIEFsd2F5cyBzdGFydCB3aXRoIFwiIyMgUmVjYXAgb2YgcGFzdCBlbnRyaWVzXCIsIGV2ZW4gaWYgdGhlcmUgYXJlIG5vIHBhc3QgZW50cmllcy5cbjYuIElmIHRoZXJlJ3MgYW4gaW5mb3JtYXRpb24gdGhhdCB0aGVyZSBhcmUgbm8gcGFzdCBlbnRyaWVzLCBqdXN0IHdyaXRlIFwiTm8gcGFzdCBlbnRyaWVzIGF2YWlsYWJsZS5cIlxuXG5UaGUgcHJvbXB0IHNob3VsZDpcbjEuIEJlIHNwZWNpZmljIGFuZCBhY3Rpb25hYmxlXG4yLiBLZWVwIGEgZnJpZW5kbHkgdG9uZSwgdGhlIHVzZXIgc2hvdWxkIGZlZWwgbGlrZSB0aGV5IGFyZSB0YWxraW5nIHRvIGEgZnJpZW5kXG4zLiBEb24ndCBzdGVlciB0aGUgdXNlciBpbnRvIGFueSBwYXJ0aWN1bGFyIGRpcmVjdGlvbiwgd2Ugd2FudCB0byBsZXQgdGhlIHVzZXIgZXhwbG9yZSB0aGVpciBvd24gdGhvdWdodHMgYW5kIGZlZWxpbmdzXG40LiBNYWtlIHRoZSBwcm9tcHQgb3Blbi1lbmRlZCwgaW4gdGhlIGZpcnN0IG1lc3NhZ2Ugd2Ugd2FudCB0byBleHBsb3JlIGhvdyB0aGUgdXNlciBpcyBmZWVsaW5nIHRvZGF5IGFuZCB3aGF0IHRoZXkgd2FudCB0byBhY2hpZXZlIHdpdGggdGhlIGpvdXJuYWxcbjUuIEluZm9ybSB0aGUgdXNlciB0aGF0IHRoZXkgY2FuIGNob29zZSBvbmUgcXVlc3Rpb24gYW5kIGNvbnRpbnVlIGNvbnZlcnNhdGlvbiB3aXRoIHRoZSBhc3Npc3RhbnRcbjYuIEJlIGNvbmNpc2UsIGlmIHlvdSBhc2sgcXVlc3Rpb25zLCBtYWtlIHRoZW0gYSBsaXN0IG9mIGJ1bGxldCBwb2ludHMgc28gaXQncyBlYXN5IHRvIHJlYWRcbjcuIFN0YXJ0IHdpdGggXCIjIyBUb2RheSdzIFByb21wdFwiXG5cbktlZXAgdGhlIHByb21wdCBjb25jaXNlIGFuZCBmb2N1c2VkIG9uIGEgc2luZ2xlIGFzcGVjdCBvZiBzZWxmLXJlZmxlY3Rpb24uIFBsZWFzZSBzdHJ1Y3R1cmUgeW91ciBvdXRwdXQgc28gaXQncyBlYXN5IHRvIHJlYWQgYW5kIHVuZGVyc3RhbmQuXG5cblxuVGhlIGZpbmFsIHN0cnVjdHVyZSBzaG91bGQgbG9vayBsaWtlIHRoaXM6XG5cbiMjIFJlY2FwIG9mIHBhc3QgZW50cmllc1xuPG91dGxpbmUgb2YgcGFzdCBlbnRyaWVzPlxuXG4jIyBUb2RheSdzIFByb21wdFxuPHByb21wdD5gIiwgImV4cG9ydCBkZWZhdWx0IGBBcyBhbiBBSSBqb3VybmFsaW5nIGFzc2lzdGFudCwgeW91IGFyZSBoZWxwaW5nIHRoZSB1c2VyIGV4cGxvcmUgdGhlaXIgdGhvdWdodHMgYW5kIGdvYWxzLlxuR3VpZGluZyBwcmluY2lwbGVzOlxuXHUyMDIyIE1haW50YWluIGEgZnJpZW5kbHksIGVtcGF0aGV0aWMgdG9uZVxuXHUyMDIyIEFzayBjbGFyaWZ5aW5nIHF1ZXN0aW9ucyBvciBkZWVwZXIgcHJvbXB0c1xuXHUyMDIyIEF2b2lkIHN0ZWVyaW5nIHRoZSB1c2VyIHRvIHNwZWNpZmljIGJlbGllZnMgb3IgY29uY2x1c2lvbnNcblx1MjAyMiBLZWVwIHRoZSBjb252ZXJzYXRpb24gcmVsZXZhbnQgdG8gdGhlIHVzZXJcdTIwMTlzIHN0YXRlZCBnb2Fsc1xuXHUyMDIyIEVuY291cmFnZSByZWZsZWN0aW9uIGFuZCBhY3Rpb25hYmxlIG91dGNvbWVzIHdoZXJlIGFwcHJvcHJpYXRlXG5SZW1lbWJlcjogYWxsIGludGVyYWN0aW9ucyB0YWtlIHBsYWNlIGluIHRoZSB1c2VyXHUyMDE5cyBub3RlLmA7ICIsICJpbXBvcnQgeyBPcGVuQUlTZXJ2aWNlIH0gZnJvbSAnLi9PcGVuQUlTZXJ2aWNlJztcbmltcG9ydCBjaGF0UHJvbXB0IGZyb20gJy4uL3Byb21wdHMvY2hhdFByb21wdCc7XG5cbmV4cG9ydCBjbGFzcyBDaGF0U2VydmljZSB7XG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBvcGVuQUlTZXJ2aWNlOiBPcGVuQUlTZXJ2aWNlKSB7fVxuXG4gICAgLyoqXG4gICAgICogU2VuZHMgdGhlIHVzZXJcdTIwMTlzIG5vdGUgY29udGVudCAod2l0aCBhbnkgdHJhbnNjcmliZWQgdGV4dCkgdG8gT3BlbkFJXG4gICAgICogYW5kIHJldHVybnMgYSBmcmllbmRseSwgY29udmVyc2F0aW9uYWwgcmVzcG9uc2UuXG4gICAgICovXG4gICAgYXN5bmMgY2hhdCh0cmFuc2NyaWJlZFRleHQ6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIGNvbnN0IHByb21wdCA9IGAke2NoYXRQcm9tcHR9XFxuXFxuVXNlcjogJHt0cmFuc2NyaWJlZFRleHR9XFxuXFxuQXNzaXN0YW50OmA7XG4gICAgICAgIHJldHVybiB0aGlzLm9wZW5BSVNlcnZpY2UubWFrZU9wZW5BSVJlcXVlc3QocHJvbXB0KTtcbiAgICB9XG59ICIsICJpbXBvcnQgeyBOb3RpY2UgfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgeyBKb3VybmFsaW5nQXNzaXN0YW50U2V0dGluZ3MgfSBmcm9tICcuLi90eXBlcyc7XG5cbmV4cG9ydCBjbGFzcyBPcGVuQUlTZXJ2aWNlIHtcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHNldHRpbmdzOiBKb3VybmFsaW5nQXNzaXN0YW50U2V0dGluZ3MpIHt9XG5cbiAgICB1cGRhdGVTZXR0aW5ncyhzZXR0aW5nczogSm91cm5hbGluZ0Fzc2lzdGFudFNldHRpbmdzKSB7XG4gICAgICAgIHRoaXMuc2V0dGluZ3MgPSBzZXR0aW5ncztcbiAgICB9XG5cbiAgICBhc3luYyBtYWtlT3BlbkFJUmVxdWVzdChwcm9tcHQ6IHN0cmluZywgb25DaHVuaz86IChjaHVuazogc3RyaW5nKSA9PiB2b2lkKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAgICAgaWYgKCF0aGlzLnNldHRpbmdzLm9wZW5BSUFwaUtleSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdPcGVuQUkgQVBJIGtleSBub3QgY29uZmlndXJlZCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJ2h0dHBzOi8vYXBpLm9wZW5haS5jb20vdjEvY2hhdC9jb21wbGV0aW9ucycsIHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogYEJlYXJlciAke3RoaXMuc2V0dGluZ3Mub3BlbkFJQXBpS2V5fWAsXG4gICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgICAgIG1vZGVsOiAnZ3B0LTRvLW1pbmknLFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlczogW3sgcm9sZTogJ3VzZXInLCBjb250ZW50OiBwcm9tcHQgfV0sXG4gICAgICAgICAgICAgICAgICAgIHRlbXBlcmF0dXJlOiAwLjcsXG4gICAgICAgICAgICAgICAgICAgIHN0cmVhbTogISFvbkNodW5rLCAvLyBFbmFibGUgc3RyZWFtaW5nIGlmIG9uQ2h1bmsgY2FsbGJhY2sgaXMgcHJvdmlkZWRcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yLmVycm9yPy5tZXNzYWdlIHx8ICdBUEkgcmVxdWVzdCBmYWlsZWQnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gSGFuZGxlIHN0cmVhbWluZyByZXNwb25zZVxuICAgICAgICAgICAgaWYgKG9uQ2h1bmspIHtcbiAgICAgICAgICAgICAgICBjb25zdCByZWFkZXIgPSByZXNwb25zZS5ib2R5Py5nZXRSZWFkZXIoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBkZWNvZGVyID0gbmV3IFRleHREZWNvZGVyKCk7XG4gICAgICAgICAgICAgICAgbGV0IGZ1bGxSZXNwb25zZSA9ICcnO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFyZWFkZXIpIHRocm93IG5ldyBFcnJvcignUmVzcG9uc2UgYm9keSBpcyBudWxsJyk7XG5cbiAgICAgICAgICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGRvbmUsIHZhbHVlIH0gPSBhd2FpdCByZWFkZXIucmVhZCgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZG9uZSkgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2h1bmsgPSBkZWNvZGVyLmRlY29kZSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGxpbmVzID0gY2h1bmsuc3BsaXQoJ1xcbicpLmZpbHRlcihsaW5lID0+IGxpbmUudHJpbSgpICE9PSAnJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobGluZS5pbmNsdWRlcygnW0RPTkVdJykpIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFsaW5lLnN0YXJ0c1dpdGgoJ2RhdGE6JykpIGNvbnRpbnVlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGpzb24gPSBKU09OLnBhcnNlKGxpbmUuc2xpY2UoNSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBqc29uLmNob2ljZXNbMF0/LmRlbHRhPy5jb250ZW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb250ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxSZXNwb25zZSArPSBjb250ZW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNodW5rKGNvbnRlbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ0ZhaWxlZCB0byBwYXJzZSBzdHJlYW1pbmcgcmVzcG9uc2U6JywgZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZnVsbFJlc3BvbnNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBIYW5kbGUgbm9uLXN0cmVhbWluZyByZXNwb25zZVxuICAgICAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgIHJldHVybiBkYXRhLmNob2ljZXNbMF0ubWVzc2FnZS5jb250ZW50O1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignT3BlbkFJIEFQSSBlcnJvcjonLCBlcnJvcik7XG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgIH1cbn0gIiwgImltcG9ydCB7IEFwcCwgUGx1Z2luU2V0dGluZ1RhYiwgU2V0dGluZyB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB0eXBlIHsgSm91cm5hbGluZ0Fzc2lzdGFudFBsdWdpbiB9IGZyb20gJy4uLy4uL21haW4nO1xuXG5leHBvcnQgY2xhc3MgSm91cm5hbGluZ0Fzc2lzdGFudFNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcHJpdmF0ZSBwbHVnaW46IEpvdXJuYWxpbmdBc3Npc3RhbnRQbHVnaW4pIHtcbiAgICAgICAgc3VwZXIoYXBwLCBwbHVnaW4pO1xuICAgIH1cblxuICAgIGRpc3BsYXkoKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XG4gICAgICAgIGNvbnRhaW5lckVsLmVtcHR5KCk7XG5cbiAgICAgICAgY29udGFpbmVyRWwuY3JlYXRlRWwoJ2gyJywgeyB0ZXh0OiAnSm91cm5hbGluZyBBc3Npc3RhbnQgU2V0dGluZ3MnIH0pO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoJ0pvdXJuYWwgRm9sZGVyJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdUaGUgZm9sZGVyIHdoZXJlIHlvdXIgam91cm5hbCBlbnRyaWVzIHdpbGwgYmUgc3RvcmVkJylcbiAgICAgICAgICAgIC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuICAgICAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcignSm91cm5hbCcpXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmpvdXJuYWxGb2xkZXIpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5qb3VybmFsRm9sZGVyID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pKTtcblxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKCdKb3VybmFsIElucHV0cyBGb2xkZXInKVxuICAgICAgICAgICAgLnNldERlc2MoJ1RoZSBmb2xkZXIgd2hlcmUgeW91ciBqb3VybmFsIGlucHV0cyB3aWxsIGJlIHN0b3JlZCcpXG4gICAgICAgICAgICAuYWRkVGV4dCh0ZXh0ID0+IHRleHRcbiAgICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ0lucHV0cycpXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmlucHV0c0ZvbGRlcilcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmlucHV0c0ZvbGRlciA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgICAuc2V0TmFtZSgnT3BlbkFJIEFQSSBLZXknKVxuICAgICAgICAgICAgLnNldERlc2MoJ1lvdXIgT3BlbkFJIEFQSSBrZXkgZm9yIGdlbmVyYXRpbmcgcHJvbXB0cyBhbmQgc3VtbWFyaWVzJylcbiAgICAgICAgICAgIC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuICAgICAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcignc2stLi4uJylcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3Mub3BlbkFJQXBpS2V5KVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Mub3BlbkFJQXBpS2V5ID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pKTtcblxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKCdOdW1iZXIgb2YgUGFzdCBFbnRyaWVzJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdOdW1iZXIgb2YgcGFzdCBqb3VybmFsIGVudHJpZXMgdG8gY29uc2lkZXIgd2hlbiBnZW5lcmF0aW5nIHByb21wdHMnKVxuICAgICAgICAgICAgLmFkZFNsaWRlcihzbGlkZXIgPT4gc2xpZGVyXG4gICAgICAgICAgICAgICAgLnNldExpbWl0cygwLCAxMCwgMSlcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MubnVtYmVyT2ZQYXN0RW50cmllcylcbiAgICAgICAgICAgICAgICAuc2V0RHluYW1pY1Rvb2x0aXAoKVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MubnVtYmVyT2ZQYXN0RW50cmllcyA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgICAuc2V0TmFtZSgnVXNlIFN0cmVhbWluZyBSZXNwb25zZScpXG4gICAgICAgICAgICAuc2V0RGVzYygnU3RyZWFtIEFJIHJlc3BvbnNlcyBpbiByZWFsLXRpbWUgKHJlY29tbWVuZGVkIGZvciBiZXR0ZXIgZXhwZXJpZW5jZSknKVxuICAgICAgICAgICAgLmFkZFRvZ2dsZSh0b2dnbGUgPT4gdG9nZ2xlXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnVzZVN0cmVhbWluZ1Jlc3BvbnNlKVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MudXNlU3RyZWFtaW5nUmVzcG9uc2UgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgIH1cbn0gIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsSUFBQUEsbUJBQXdEOzs7QUNRakQsSUFBTSxtQkFBZ0Q7QUFBQSxFQUN6RCxlQUFlO0FBQUEsRUFDZixjQUFjO0FBQUEsRUFDZCxjQUFjO0FBQUEsRUFDZCxxQkFBcUI7QUFBQSxFQUNyQixzQkFBc0I7QUFDMUI7OztBQ2RBLElBQUFDLG1CQUF1RDs7O0FDQXZELHNCQUFtRDtBQUs1QyxJQUFNLHVCQUFOLE1BQTJCO0FBQUEsRUFHOUIsWUFDWSxLQUNBLFVBQ1Y7QUFGVTtBQUNBO0FBRVIsU0FBSyxpQkFBaUIsSUFBSSxlQUFlLEtBQUssSUFBSSxPQUFPLEtBQUssU0FBUyxZQUFZO0FBQUEsRUFDdkY7QUFBQSxFQUVBLGVBQWUsVUFBdUM7QUFDbEQsU0FBSyxXQUFXO0FBQ2hCLFNBQUssZUFBZSxVQUFVLFNBQVMsWUFBWTtBQUFBLEVBQ3ZEO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFLQSxPQUFjLGtCQUFrQixNQUFzQjtBQUNsRCxVQUFNLG1CQUFtQixDQUFDLFFBQVEsT0FBTyxPQUFPLFFBQVEsUUFBUSxPQUFPLE9BQU8sT0FBTyxNQUFNO0FBQzNGLFVBQU0sWUFBWSxLQUFLLFVBQVUsWUFBWTtBQUM3QyxXQUFPLGlCQUFpQixTQUFTLFNBQVM7QUFBQSxFQUM5QztBQUFBO0FBQUE7QUFB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QUFLLFdBQVc7QUFBQSxNQUNaLElBQUk7QUFBQSxNQUNKLE1BQU07QUFBQSxNQUNOLFVBQVUsWUFBWTtBQUNsQixjQUFNLEtBQUsscUJBQXFCLHFCQUFxQjtBQUFBLE1BQ3pEO0FBQUEsSUFDSixDQUFDO0FBRUQsU0FBSyxXQUFXO0FBQUEsTUFDWixJQUFJO0FBQUEsTUFDSixNQUFNO0FBQUEsTUFDTixVQUFVLFlBQVk7QUFDbEIsY0FBTSxLQUFLLGVBQWUsMkJBQTJCO0FBQUEsTUFDekQ7QUFBQSxJQUNKLENBQUM7QUFHRCxTQUFLLFdBQVc7QUFBQSxNQUNaLElBQUk7QUFBQSxNQUNKLE1BQU07QUFBQSxNQUNOLFVBQVUsWUFBWTtBQUNsQixjQUFNLEtBQUssZUFBZSxXQUFXO0FBQUEsTUFDekM7QUFBQSxJQUNKLENBQUM7QUFBQSxFQUNMO0FBQUEsRUFFQSxNQUFNLGVBQWU7QUFDakIsVUFBTSxPQUFPLE1BQU0sS0FBSyxTQUFTO0FBQ2pDLFNBQUssV0FBVyxPQUFPLE9BQU8sQ0FBQyxHQUFHLGtCQUFrQixJQUFJO0FBQ3hELFlBQVEsSUFBSSxLQUFLLFFBQVE7QUFBQSxFQUM3QjtBQUFBLEVBRUEsTUFBTSxlQUFlO0FBQ2pCLFVBQU0sS0FBSyxTQUFTLEtBQUssUUFBUTtBQUVqQyxTQUFLLGdCQUFnQixJQUFJLGNBQWMsS0FBSyxRQUFRO0FBQ3BELFNBQUsscUJBQXFCLGVBQWUsS0FBSyxRQUFRO0FBQ3RELFNBQUssZUFBZSxlQUFlLEtBQUssUUFBUTtBQUFBLEVBQ3BEO0FBQUEsRUFFQSxXQUFXO0FBQ1AsWUFBUSxJQUFJLDBDQUEwQztBQUFBLEVBQzFEO0FBQ0o7QUFFQSxJQUFPLGVBQVE7IiwKICAibmFtZXMiOiBbImltcG9ydF9vYnNpZGlhbiIsICJpbXBvcnRfb2JzaWRpYW4iLCAiaW1wb3J0X29ic2lkaWFuIiwgImltcG9ydF9vYnNpZGlhbiIsICJ1cGRhdGVkQ29udGVudCIsICJpbXBvcnRfb2JzaWRpYW4iXQp9Cg==
